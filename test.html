<html>
<head>
    <style type="text/css">

        body{
          font-family: "Helvetica";
          font-size:18px;
          color: rgba(255, 255, 255 ,1);
          background-color: #404040;
          margin-top:80px;
      }

      .header{
          position:fixed;
          top: 0px;
          z-index: 100;
          background-color: rgba(0,0,0,.8);
          height:80px;
          width:100%;
      }

      ul.debugger{
          overflow:scroll;
      }

      code{
          color: #fa5c4f;
          font-family:"Courier";
      }
      table{
          display:inline-block;
          background-color: rgba(100,100,100,.5);
          border-radius: 10px;
          padding: 10px;
          margin: 10px;
          font-size: 14px;
      }
      table td{
          width:80px;
      }

      ul.debugger, ul.debugger li, ul.debugger ul, .debugger .singleItem{
          list-style: none;
          margin-left: 0px;
          margin-top: 18px;
          padding-left:3px;
      }

      ul.debugger li, .debugger .singleItem{

          border-radius: 10px 0px 0px 10px;
          border: solid 1px transparent;
          padding: 10px 0px 10px 10px;
          margin: 18px 0px 0px 0px;
          background-color: rgba(200,200,200,.05);
      }

      .origin, .size, .opacity, .rotation, .position, .skew, .scale{
          display:inline-block;
          width: 100px;
          margin-left: 5px;
      }

      .modifier{
          display: block;
          color: #3cf;
      }
      .surface{
          color: #3cf;
      }

      .selected{
          border-radius:10px 0px 0px 10px;
          background-color: rgba(255,255,255,.2)!important;
      }
      .highlight, .inspected{
        border-left: solid 1px #fa5c4f!important;
        border-top: solid 1px #fa5c4f!important;
        border-bottom: solid 1px #fa5c4f!important;
      }


      .namedNode{
          background-color: rgba(0,0,0,.1);
          border-radius: 10px 0px 0px 10px;
          color: #fa5c4f;
          width: 100%;
          display:inline-block;
          padding:5px;
          margin-bottom: 9px;
      }

      ul.transform{
          margin-bottom:9px;
          margin-top:0px !important;
          padding-top:0px;
      }
      ul.transform li{
          background-color: inherit;
          margin:3px;
          padding: 0px;
          border-radius:0px;
      }



      ul.engineControls{
          margin-left:0px;
      }

      ul.engineControls li{
          display:inline;
          margin:10px;
      }
      ul.engineControls button{
          padding: 5px;
          padding-left:10px;
          padding-right:10px;
          font-size: 14px;
          background-color: rgba(50,50,50,.5);
          border: none;
          border-radius:10px;
          color:white;
      }
      input.engineControls
      {
          padding: 5px;
          font-size: 14px;
          background-color: rgba(0,0,0,.5);
          color:white;
          width:30px;

      }

      .engineControls b{
          size:30px;
          color: #fa5c4f;
      }



      .leftCol{
          float:left;
      }
      .rightCol{
          float:right;
      }
      .clear{
          clear:both;
      }

      a.parent, a.back{
          color:#3cf;
          clear: both;
          text-decoration: none;
      }


      pre.prettyprint, code.prettyprint {
          background-color: #403c3b;
          border-color: #403c3b;
          border-width: 9px;
          padding:9px;
          border-radius: 10px 0px 0px 10px;

      }

      pre.prettyprint {
          white-space: pre-wrap;
      }


      .interactiveModifier{
        display:none;
        position: fixed;
        background-color: rgba(67,67,67,.9);
        width: 420px;
        border-radius:10px;
        box-shadow: 3px 3px 3px rgba(0,0,0,.3);
        top: 80px;
        left:50%;
        margin-left:-25%;
      }
      .interactiveModifier input{
        width: 80px;
        background-color: rgba(255,255,255,.1);
        margin:2px;
        border: none;
        padding: 5px;
        font-size: 18px;
        color: #fa5c4f;
        border-radius:5px;
      }
      .interactiveModifier .inputGroup *{
        vertical-align: middle;
      }
      .interactiveModifier .inputType{
        display: block;
        width: 500px;
      }
      .interactiveModifier label{
        display: inline-block;
        width: 80px;
      }
      .interactiveModifier .inputGroup{
        color: rgba(51,204,255,.3);
        font-size: 35px;
      }

      .interactiveModifier li{
        list-style: none;
      }

      .interactiveModifier button{
        width: 30px;
        height: 30px;
        background-color: rgba(255,255,255,.1);
        margin:9px;
        border: none;
        padding: 5px;
        font-size: 14px;
        color: white;
        border-radius:5px;
        float:right;
      }

      .interactiveModifier li:last-child{
        margin-bottom:20px;
      }

  </style>
</head>
<body>





<ul class="interactiveModifier" data-modifierId=''>
  <li><button class='close'>X</button><div class="clear"></div></li>
  <li class='inputType' data-type='opacity'>
    <label>Opacity:</label><span class='inputGroup'>[<input type='number' step="1" min="0" max="100"/>]</span>
  </li>
  <li class='inputType' data-type='size'>
    <label>Size:</label><span class='inputGroup'>[<input type='number'/>,<input type='number'/>]</span>
  </li>
  <li class='inputType' data-type='origin'>
    <label>Origin:</label><span class='inputGroup'>[<input type='number' step='.5' min='0' max='1'/>,<input type='number'  step='.5' min='0' max='1'/>]</span></li>
  <li class='inputType' data-type='position'><label>Position:</label><span class='inputGroup'>[<input type='number' step=".01"/>,<input type='number' step=".01"/>,<input type='number'/>]</span></li>
  <li class='inputType' data-type='rotation'><label>Rotation:</label><span class='inputGroup'>[<input type='number' step=".001"/>,<input type='number' step=".001"/>,<input type='number' step=".001"/>]</span></li>
  <li class='inputType' data-type='skew'><label>Skew:</label><span class='inputGroup'>[<input type='number' step=".01"/>,<input type='number' step=".01"/>,<input type='number' step=".01"/>]</span></li>
  <li class='inputType' data-type='scale'>
    <label>Scale:</label><span class='inputGroup'>[<input type='number' step=".1"/>,<input type='number' step=".1"/>,<input type='number' step=".1"/>]
    </span>
  </li>
</ul>











<ul class='debugger'><li><span class='namedNode'>origin mod</span><span class='modifier' id='modifier_4'><span>Modifier: </span><a id='node_0'></a></span><div class='leftCol'><ul class='transform'><li><label class='opacity'>Opacity:  </label><code>1</code></li><li><label class='size'>Size: </label><code>[0,0]</code></li><li><label class='origin'>Origin:  </label><code>[0.5,0.5]</code></li><li><label class='position'>Position:  </label></li><li><label class='rotation'>Rotation:  </label></li><li><label class='rotation'>Skew:  </label></li><li><label class='rotation'>Scale:  </label><code>[1,1,1]</code></li></ul></div><div class='rightCol'><table><tr><td>1</td><td>0</td><td>0</td><td>0</td></tr><tr><td>0</td><td>1</td><td>0</td><td>0</td></tr><tr><td>0</td><td>0</td><td>1</td><td>0</td></tr><tr><td>0</td><td>0</td><td>0</td><td>1</td></tr></table></div><div class='clear singleItem'><span class='namedNode'>rotate X mod</span><span class='modifier' id='modifier_5'><span>Modifier: </span><a id='node_1'></a><a id='parent_node_0' class='parent' href='#node_0'>&uarr;</a></span><div class='leftCol'><ul class='transform'><li><label class='opacity'>Opacity:  </label><code>1</code></li><li><label class='size'>Size: </label></li><li><label class='origin'>Origin:  </label><code>[0.5,0.5]</code></li><li><label class='position'>Position:  </label></li><li><label class='rotation'>Rotation:  </label><code>[0.005,0,0]</code></li><li><label class='rotation'>Skew:  </label></li><li><label class='rotation'>Scale:  </label><code>[1,1,1]</code></li></ul></div><div class='rightCol'><table><tr><td>1</td><td>0</td><td>0</td><td>0</td></tr><tr><td>0</td><td>1</td><td>0.005</td><td>0</td></tr><tr><td>0</td><td>-0.005</td><td>1</td><td>0</td></tr><tr><td>0</td><td>0</td><td>0</td><td>1</td></tr></table></div><div class='clear singleItem'><span class='namedNode'>rotate y mod</span><span class='modifier' id='modifier_6'><span>Modifier: </span><a id='node_2'></a><a id='parent_node_1' class='parent' href='#node_1'>&uarr;</a></span><div class='leftCol'><ul class='transform'><li><label class='opacity'>Opacity:  </label><code>1</code></li><li><label class='size'>Size: </label></li><li><label class='origin'>Origin:  </label><code>[0.5,0.5]</code></li><li><label class='position'>Position:  </label></li><li><label class='rotation'>Rotation:  </label><code>[0,-0.893,0]</code></li><li><label class='rotation'>Skew:  </label></li><li><label class='rotation'>Scale:  </label><code>[1,1,1]</code></li></ul></div><div class='rightCol'><table><tr><td>0.627</td><td>0</td><td>0.779</td><td>0</td></tr><tr><td>0</td><td>1</td><td>0</td><td>0</td></tr><tr><td>-0.779</td><td>0</td><td>0.627</td><td>0</td></tr><tr><td>0</td><td>0</td><td>0</td><td>1</td></tr></table></div><div class='clear singleItem'><span class='namedNode'>rotate z mod</span><span class='modifier' id='modifier_7'><span>Modifier: </span><a id='node_3'></a><a id='parent_node_2' class='parent' href='#node_2'>&uarr;</a></span><div class='leftCol'><ul class='transform'><li><label class='opacity'>Opacity:  </label><code>1</code></li><li><label class='size'>Size: </label></li><li><label class='origin'>Origin:  </label><code>[0.5,0.5]</code></li><li><label class='position'>Position:  </label></li><li><label class='rotation'>Rotation:  </label><code>[0,0,-2.649]</code></li><li><label class='rotation'>Skew:  </label></li><li><label class='rotation'>Scale:  </label><code>[1,1,1]</code></li></ul></div><div class='rightCol'><table><tr><td>-0.881</td><td>-0.473</td><td>0</td><td>0</td></tr><tr><td>0.473</td><td>-0.881</td><td>0</td><td>0</td></tr><tr><td>0</td><td>0</td><td>1</td><td>0</td></tr><tr><td>0</td><td>0</td><td>0</td><td>1</td></tr></table></div><div class='clear singleItem'><span class='namedNode'>SubView</span><ul><li><span class='modifier' id='modifier_1'><span>Modifier: </span><a id='node_4'></a><a id='parent_node_3' class='parent' href='#node_3'>&uarr;</a></span><div class='leftCol'><ul class='transform'><li><label class='opacity'>Opacity:  </label><code>1</code></li><li><label class='size'>Size: </label></li><li><label class='origin'>Origin:  </label><code>[0.5,0.5]</code></li><li><label class='position'>Position:  </label></li><li><label class='rotation'>Rotation:  </label></li><li><label class='rotation'>Skew:  </label></li><li><label class='rotation'>Scale:  </label><code>[1,1,1]</code></li></ul></div><div class='rightCol'><table><tr><td>1</td><td>0</td><td>0</td><td>0</td></tr><tr><td>0</td><td>1</td><td>0</td><td>0</td></tr><tr><td>0</td><td>0</td><td>1</td><td>0</td></tr><tr><td>0</td><td>0</td><td>0</td><td>1</td></tr></table></div><div class='clear'></div><span class='surface' id='surface_0'>Surface: </span><pre class='prettyprint lang-js'>{
    "id": 0,
    "name": "Front Surface",
    "options": {},
    "size": [
        400,
        400
    ],
    "properties": {
        "backgroundColor": "#89bbff",
        "webkitBackfaceVisibility": "visible",
        "opacity": 0.9
    },
    "content": "",
    "classList": [
        "dot"
    ]
}</pre></li><li><span class='modifier' id='modifier_2'><span>Modifier: </span><a id='node_4'></a><a id='parent_node_3' class='parent' href='#node_3'>&uarr;</a></span><div class='leftCol'><ul class='transform'><li><label class='opacity'>Opacity:  </label><code>1</code></li><li><label class='size'>Size: </label></li><li><label class='origin'>Origin:  </label><code>[0.5,0.5]</code></li><li><label class='position'>Position:  </label></li><li><label class='rotation'>Rotation:  </label><code>[1.571,0,0]</code></li><li><label class='rotation'>Skew:  </label></li><li><label class='rotation'>Scale:  </label><code>[1,1,1]</code></li></ul></div><div class='rightCol'><table><tr><td>1</td><td>0</td><td>0</td><td>0</td></tr><tr><td>0</td><td>0</td><td>1</td><td>0</td></tr><tr><td>0</td><td>-1</td><td>0</td><td>0</td></tr><tr><td>0</td><td>0</td><td>0</td><td>1</td></tr></table></div><div class='clear'></div><span class='surface' id='surface_1'>Surface: </span><pre class='prettyprint lang-js'>{
    "id": 1,
    "name": "Back Surface",
    "options": {},
    "size": [
        400,
        400
    ],
    "properties": {
        "backgroundColor": "#e7dd00",
        "webkitBackfaceVisibility": "visible",
        "opacity": 0.9
    },
    "content": "",
    "classList": [
        "dot"
    ]
}</pre></li><li><span class='modifier' id='modifier_3'><span>Modifier: </span><a id='node_4'></a><a id='parent_node_3' class='parent' href='#node_3'>&uarr;</a></span><div class='leftCol'><ul class='transform'><li><label class='opacity'>Opacity:  </label><code>1</code></li><li><label class='size'>Size: </label></li><li><label class='origin'>Origin:  </label><code>[0.5,0.5]</code></li><li><label class='position'>Position:  </label></li><li><label class='rotation'>Rotation:  </label><code>[0,1.571,0]</code></li><li><label class='rotation'>Skew:  </label></li><li><label class='rotation'>Scale:  </label><code>[1,1,1]</code></li></ul></div><div class='rightCol'><table><tr><td>0</td><td>0</td><td>-1</td><td>0</td></tr><tr><td>0</td><td>1</td><td>0</td><td>0</td></tr><tr><td>1</td><td>0</td><td>0</td><td>0</td></tr><tr><td>0</td><td>0</td><td>0</td><td>1</td></tr></table></div><div class='clear'></div><span class='surface' id='surface_2'>Surface: </span><pre class='prettyprint lang-js'>{
    "id": 2,
    "name": "Middle Surface",
    "options": {},
    "size": [
        400,
        400
    ],
    "properties": {
        "backgroundColor": "rgba(137,232,144,1)",
        "webkitBackfaceVisibility": "visible",
        "opacity": 0.9
    },
    "content": "",
    "classList": [
        "dot"
    ]
}</pre></li></ul></div></div></div></div></li></ul>
















<script type="text/javascript">

//Dom helpers
function fDom(selector){
  return document.querySelectorAll(selector);
}

fDom.remove = function(selector){
    this.forEach(this(".back"), function(el){
      el.parentNode.removeChild(el);
    });
}

fDom.forEach = function(domList, callback){
  [].forEach.call(domList, callback);
}

fDom.createFragment = function(fragment){
  var container = document.createElement("div");
  container.innerHTML = fragment;
  return container.childNodes;

}
fDom.animateScrollTo = function(pos){
    if(pos< 0) {pos = 0};
    loop = 60;

     window.requestAnimationFrame(function animateScroll(){
        var diff = pos - document.body.scrollTop;
        var newPos = document.body.scrollTop + diff/(loop/5);

        window.scroll(0, newPos);
        loop--;
        if(loop > 0){
            window.requestAnimationFrame(animateScroll);
        }
    });
}

fDom.findPos = function(obj) {
    var curtop = 0;
    if (obj.offsetParent) {
        do {
            curtop += obj.offsetTop;
        } while (obj = obj.offsetParent);
        return [curtop];
    }
}





  fDom.forEach(fDom(".parent"), function(el){

    el.addEventListener("mouseover", function(){
      var targetNode = el.getAttribute("href").replace("#","");
      document.getElementById(targetNode).parentNode.parentNode.classList.add("highlight");
    });

    el.addEventListener("mouseout", function(){
      var targetNode = el.getAttribute("href").replace("#","");
      document.getElementById(targetNode).parentNode.parentNode.classList.remove("highlight");
    });

    el.addEventListener("click", function(event){
        event.preventDefault();
        var targetId = this.hash.slice(1);
        var target = document.getElementById(targetId);

        //highlight the inspected modifier
        fDom.forEach(fDom(".inspected"), function(el){
            el.classList.remove("inspected");
        });

        target.parentNode.parentNode.classList.add("inspected");

        //remove other back links
        fDom.remove(".back");

        //add a back link
        var backLink = fDom.createFragment("<a href='#parent_" + targetId + "' class='back'>&darr;</a>")[0];
        target.parentNode.appendChild(backLink);

        //handle backlink animation back
        backLink.addEventListener("click", function(event){
          event.preventDefault();
          fDom.remove(".back");
          fDom.animateScrollTo(fDom.findPos(el) -200 );
        });

        //scroll to the link
        var targetPos = fDom.findPos(target);
        fDom.animateScrollTo(targetPos -200 );
        
    }.bind(el));
});


//wire up inspection link
fDom.forEach(fDom(".surface"), function(el){

    //handle backlink animation back
    el.addEventListener("click", function(event){
        var id = this.id.replace("surface_", "");
        _insepectSurfaceInDom(id);
    }.bind(el));        
});




//wire up the interactiveInspector
fDom.forEach(fDom(".modifier"), function(el){

    //handle backlink animation back
    el.children[0].addEventListener("click", function(event){
        var id = this.id.replace("modifier_", "");
        var modifier = document.querySelector(".interactiveModifier");

        resetInteractiveModifier();

        //load the data in
        requestModifier(id);

    }.bind(el.children[0]));        
});

//wire up the hide button
document.querySelector(".interactiveModifier .close").addEventListener("click", function(event){
  var modifier = document.querySelector(".interactiveModifier");
  modifier.dataset["modifierId"] = null;
  modifier.style.display = "none";
});


//TODO: Read in the values from the exisiting modifier, 
//fire change event an value change
fDom.forEach(fDom(".interactiveModifier input[type='number']"), function(num){
   num.addEventListener("change", function(event){

        var modifier = document.querySelector(".interactiveModifier");
        var modId = modifier.dataset["modifierId"];

        if(!modId) return;

        
        var inputs = num.parentElement.querySelectorAll("input[type='number']")
        var values = [].map.call(inputs, function(i){return i.value});
        var type = num.parentNode.parentNode.dataset["type"];

        console.log(modId, type, values);
    }.bind(num));  
});


function resetInteractiveModifier(){
  var inputs = fDom(".interactiveModifier input[type='number']");
  fDom.forEach(inputs, function(i){
    i.value = "";
  });
}

function requestModifier(id){
    // var cmd = "window.postMessage({"+
    //         "type: 'request.modifier'" + 
    //         "text: window.FamousDebugger.Modifiers.getModifier(" + id + ")" +
    //     "})";

    // chrome.devtools.inspectedWindow.eval(cmd,{ useContentScriptContext: true });
        

        //DEBUG
        var fakeData = {"origin": [.5,.5], translate:[null,null,null],"rotate":[0,null,null],"scale":[null,null,null],"skew":[null,null,null],"transform":[0.9605304970014414,0.2739099422887111,-0.0485232711753488,0,-0.19470917115432507,0.7865976938782454,0.5859628031315792,0,0.19866933079506113,-0.5533872166040855,0.8088838516750236,0,0,0,0,1],"id":0,"opacity":1,"size":null};

        bindInteractiveModifier(fakeData);
}

function bindInteractiveModifier(modifier){

  //the the modifier id, note the order of operations is important
  //because of the onchange handler
  var interactiveMod = document.querySelector(".interactiveModifier");
  interactiveMod.dataset["modifierId"] = modifier.id;
  interactiveMod.style.display = "block";
  
  debugger
  bindData("[data-type='opacity']", [modifier.opacity] );
  bindData("[data-type='size']", modifier.size );
  bindData("[data-type='origin']", modifier.origin );
  bindData("[data-type='position']", modifier.translate );
  bindData("[data-type='rotation']", modifier.rotate );
  bindData("[data-type='scale']", modifier.scale );
  bindData("[data-type='skew']", modifier.skew );

}


function bindData(selector, values){
  if(!values) return;

  var interactiveMod = document.querySelector(".interactiveModifier");

  [].forEach.call(interactiveMod.querySelector(selector).querySelectorAll("input"), function(item, index){
    item.value = values[index];
  });

}

// <ul class="interactiveModifier" data-modifierId=''>
//   <li><button class='close'>X</button><div class="clear"></div></li>
//   <li class='inputType' data-type='opacity'>
//     <label>Opacity:</label><span class='inputGroup'>[<input type='number' step="1" min="0" max="100"/>]</span>
//   </li>
//   <li class='inputType' data-type='size'>
//     <label>Size:</label><span class='inputGroup'>[<input type='number'/>,<input type='number'/>]</span>
//   </li>
//   <li class='inputType' data-type='origin'>
//     <label>Origin:</label><span class='inputGroup'>[<input type='number' step='.5' min='0' max='1'/>,<input type='number'  step='.5' min='0' max='1'/>]</span></li>
//   <li class='inputType' data-type='position'><label>Position:</label><span class='inputGroup'>[<input type='number' step=".01"/>,<input type='number' step=".01"/>,<input type='number'/>]</span></li>
//   <li class='inputType' data-type='rotation'><label>Rotation:</label><span class='inputGroup'>[<input type='number' step=".001"/>,<input type='number' step=".001"/>,<input type='number' step=".001"/>]</span></li>
//   <li class='inputType' data-type='skew'><label>Skew:</label><span class='inputGroup'>[<input type='number' step=".01"/>,<input type='number' step=".01"/>,<input type='number' step=".01"/>]</span></li>
//   <li class='inputType' data-type='scale'>
//     <label>Scale:</label><span class='inputGroup'>[<input type='number' step=".1"/>,<input type='number' step=".1"/>,<input type='number' step=".1"/>]
//     </span>
//   </li>
// </ul>



</script>
</body>